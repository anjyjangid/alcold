<div class="row" ng-controller="ProductAddController">
	<div class="col-md-12">
		<form role="form" name='productForm' ng-submit="store()" required="false">
		<div class="portlet light">			
			<div class="portlet-title">
				<div class="caption">
					<i class="fa fa-shopping-cart"></i>Add New Product
				</div>
				<div class="actions btn-set">
					<a class="btn default" href="#/product/list"><i class="fa fa-angle-left"></i> Back</a>
					<button class="btn green" type="submit"><i class="fa fa-check"></i> Save</button>
					<!-- <button class="btn green"><i class="fa fa-check-circle"></i> Save & Continue Edit</button> -->
					<!-- <div class="btn-group">
						<a class="btn yellow dropdown-toggle" href="javascript:;" data-toggle="dropdown">
						<i class="fa fa-share"></i> More <i class="fa fa-angle-down"></i>
						</a>
						<ul class="dropdown-menu pull-right">
							<li>
								<a href="javascript:;">
								Duplicate </a>
							</li>
							<li>
								<a href="javascript:;">
								Delete </a>
							</li>
							<li class="divider">
							</li>
							<li>
								<a href="javascript:;">
								Print </a>
							</li>
						</ul>
					</div> -->
				</div>
			</div>
			<div class="portlet-body">				
				<tabset active="active">
					<tab>
						<tab-heading>General</tab-heading>

						<div class="form-horizontal">
							<div class="form-group" ng:class="{'has-error':errors.name[0]}">
								<label class="col-md-2 control-label">Name: <span class="required">
								* </span>
								</label>
								<div class="col-md-10">
									<input type="text" class="form-control" ng-model="product.name" placeholder="">
									<span class="help-block" ng-bind="errors.name[0]"></span>
								</div>

							</div>
							<div class="form-group" ng:class="{'has-error':errors.description[0]}">
								<label class="col-md-2 control-label">Description: <span class="required">
								* </span>
								</label>
								<div class="col-md-10">
									<textarea class="form-control" ng-model="product.description"></textarea>
									<span class="help-block" ng-bind="errors.description[0]"></span>
								</div>
							</div>
							<div class="form-group" ng:class="{'has-error':errors.shortDescription[0]}">
								<label class="col-md-2 control-label">Short Description: <span class="required">
								* </span>
								</label>
								<div class="col-md-10">
									<textarea class="form-control" ng-model="product.shortDescription" style="margin-top: 0px; margin-bottom: 0px; height: 54px;"></textarea>
									<span class="help-block" ng-bind="errors.shortDescription[0]"></span>
								</div>
							</div>
							<div class="form-group" ng:class="{'has-error':errors.categories[0]}">
								<label class="col-md-2 control-label">Categories: <span class="required">
								* </span>
								</label>
								<div class="col-md-10">
									<div class="form-control height-auto" id="checkable">
										<div class="slimScrollDiv" style="overflow: auto; width: auto; height: 275px;">
											<ul class="list-unstyled" ng-include="'categoryLiTree'"></ul>
										</div>
									</div>
									<span class="help-block">
									select one or more categories </span>
									<span class="help-block" ng-bind="errors.categories[0]"></span>
								</div>
							</div>							
							<div class="form-group" ng:class="{'has-error':errors.sku[0]}">
								<label class="col-md-2 control-label">SKU: <span class="required">
								* </span>
								</label>
								<div class="col-md-10">
									<input type="text" class="form-control" ng-model="product.sku" placeholder="">
									<span class="help-block" ng-bind="errors.sku[0]"></span>
								</div>
							</div>
							
							
							<div class="form-group" ng:class="{'has-error':errors.quantity[0]}">
								<label class="col-md-2 control-label">Quantity: <span class="required">
								* </span>
								</label>
								<div class="col-md-10">
									<input type="number" class="form-control" ng-model="product.quantity" placeholder="">									
									<span class="help-block" ng-bind="errors.quantity[0]"></span>
								</div>
							</div>
							<div class="form-group">
								<label class="control-label col-md-2">Chilled/Non-chilled <span class="required" aria-required="true">
								* </span></label>
								<div class="col-md-4">
								
								<div class="radio-list">
									<label class="radio-inline">
									<input ng-model="product.chilled" type="radio" value="1" name="chilled"> Yes </label>
									<label class="radio-inline">
									<input ng-model="product.chilled" type="radio" value="0" name="chilled"> No </label>
								</div>

								</div>
							</div>
							<div class="form-group">
								<label class="control-label col-md-2">Is Featured<span class="required" aria-required="true">
								* </span></label>
								<div class="col-md-4">
								
								<div class="radio-list">
									<label class="radio-inline">
									<input ng-model="product.isFeatured" type="radio" value="1" name="isFeatured"> Yes </label>
									<label class="radio-inline">
									<input ng-model="product.isFeatured" type="radio" value="0" name="isFeatured"> No </label>
								</div>

								</div>
							</div>														
							<div class="form-group" ng:class="{'has-error':errors.status[0]}">
								<label class="col-md-2 control-label">Status: <span class="required">
								* </span>
								</label>
								<div class="col-md-10">
									<select class="table-group-action-input form-control input-medium" ng-model="product.status">
										<option value="">Select...</option>
										<option value="1">Published</option>
										<option value="0">Not Published</option>
									</select>
									<span class="help-block" ng-bind="errors.status[0]"></span>
								</div>
							</div>
						</div>

					</tab>
					<tab>
						<tab-heading>Pricing</tab-heading>
						<div class="form-horizontal">
							<div class="form-group" ng:class="{'has-error':errors.price[0]}">
								<label class="col-md-4 control-label">Cost Price: <span class="required">
								* </span>
								</label>
								<div class="col-md-3">
									<div class="input-group">
										<input type="number" step="any" class="form-control" ng-model="product.price" placeholder="">									
										<span class="input-group-addon">
											Per Unit
										</span>
									</div>
									<span class="help-block" ng-bind="errors.price[0]"></span>
								</div>								
							</div>
							<div ng-if="product.price">
								
								<h4>Pricing for different tiers</h4>									
								<div class="form-group">
									<div class="col-md-2 col-md-offset-4">Calculated</div>
									<div class="col-md-2">Custom</div>
								</div>
								<div class="form-group" ng-if="price.category == 'pricing'" ng-repeat="(kp, price) in pricing.settings">
									<label class="col-md-4 control-label">{{price.label}}: </label>
									<div class="col-md-2">
										<div class="form-control">
											{{ price.type==0 ? formatNumber(product.price+price.value) : formatNumber(product.price+(product.price/100*price.value)) }}
										</div>
									</div>
									<div class="col-md-2">
										<div class="input-group" >
											<input type="number" step="any" class="form-control" ng-model="product[kp]" placeholder="">
										</div>
									</div>
								</div>
							</div>							
						</div>
					</tab>	
					<tab>
						<tab-heading>Bulk Discounts</tab-heading>
						
						<div id="tab_images_uploader_container" class="text-align-reverse margin-bottom-10">
							<a id="tab_images_uploader_pickfiles" href="#" ng-click="product.bulkDiscount.push({})" class="btn yellow">
							<i class="fa fa-plus"></i> Add</a>							
						</div>

						<table class="table table-bordered table-hover">
							<thead>
								<tr role="row" class="heading">
									<th width="30%">
										 Quantity
									</th>
									<th width="30%">
										 Discount type
									</th>
									<th width="30%">
										 Value
									</th>									
									<th width="10%">
									</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="d in product.bulkDiscount">
									<td ng:class="{'has-error':errors['bulkDiscount.'+$index+'.quantity'][0]}">
										<input type="number" class="form-control" ng-model="d.quantity">
										<span class="help-block" ng-bind="errors['bulkDiscount.'+$index+'.quantity'][0]"></span>
									</td>
									<td ng:class="{'has-error':errors['bulkDiscount.'+$index+'.type'][0]}">
										<select class="form-control" ng-model="d.type">
											<option value="">Select type</option>
											<option value="1">Fix amount</option>
											<option value="2">% of amount</option>
										</select>										
										<span class="help-block" ng-bind="errors['bulkDiscount.'+$index+'.type'][0]"></span>
									</td>
									<td ng:class="{'has-error':errors['bulkDiscount.'+$index+'.value'][0]}">
										<input type="text" class="form-control" ng-model="d.value">
										<span class="help-block" ng-bind="errors['bulkDiscount.'+$index+'.value'][0]"></span>
									</td>
									<td>
										<a href="#" class="btn default btn-sm" ng-click="discountRemove($index)">
										<i class="fa fa-times"></i> Remove </a>
									</td>
								</tr>
							</tbody>
						</table>	

					</tab>
					<tab>
						<tab-heading>Meta</tab-heading>
						
						<div class="form-horizontal">
							<div class="form-group" ng:class="{'has-error':errors.metaTitle[0]}">
								<label class="col-md-2 control-label">Meta Title:</label>
								<div class="col-md-10">
									<input type="text" class="form-control maxlength-handler" ng-model="product.metaTitle" maxlength="100" placeholder="">
									<span class="help-block">
									max 100 chars </span>
									<span class="help-block" ng-bind="errors.metaTitle[0]"></span>
								</div>
							</div>
							<div class="form-group" ng:class="{'has-error':errors.metaKeywords[0]}">
								<label class="col-md-2 control-label">Meta Keywords:</label>
								<div class="col-md-10">
									<textarea class="form-control maxlength-handler" rows="8" ng-model="product.metaKeywords" maxlength="1000"></textarea>
									<span class="help-block">
									max 1000 chars </span>
									<span class="help-block" ng-bind="errors.metaKeywords[0]"></span>
								</div>
							</div>
							<div class="form-group" ng:class="{'has-error':errors.metaDescription[0]}">
								<label class="col-md-2 control-label">Meta Description:</label>
								<div class="col-md-10">
									<textarea class="form-control maxlength-handler" rows="8" ng-model="product.metaDescription" maxlength="255"></textarea>
									<span class="help-block">
									max 255 chars </span>
									<span class="help-block" ng-bind="errors.metaDescription[0]"></span>
								</div>
							</div>
						</div>

					</tab>
						
					<tab>
						<tab-heading>Images</tab-heading>

						<div ng-show="errors.imageFiles[0]" class="alert alert-danger fade in">
							<i class="fa-lg fa fa-warning"></i>
							{{ errors.imageFiles[0] }}
						</div>

						<div id="tab_images_uploader_container" class="text-align-reverse margin-bottom-10">
							<a id="tab_images_uploader_pickfiles" href="#" ng-click="product.imageFiles.push({})" class="btn yellow">
							<i class="fa fa-plus"></i> Add Files </a>
							<!-- <a id="tab_images_uploader_uploadfiles" href="#" ng-click="uploadFiles()" class="btn green">
							<i class="fa fa-share"></i> Upload Files </a> -->
						</div>
						<div class="row">
							<div id="tab_images_uploader_filelist" class="col-md-6 col-sm-12">
							</div>
						</div>
						<table class="table table-bordered table-hover">
							<thead>
								<tr role="row" class="heading">
									<th width="8%">
										 Image
									</th>
									<th width="25%">
										 Label
									</th>
									<th width="8%">
										 Sort Order
									</th>
									<th width="10%">
										 Cover Image
									</th>									
									<th width="10%">
									</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="f in product.imageFiles">
									<td ng:class="{'has-error':errors['imageFiles.'+$index+'.thumb'][0]}">
										<div class="fileinput fileinput-new" data-provides="fileinput">
											<div class="fileinput-new thumbnail" style="max-width: 200px; max-height: 150px;">
												<img src="http://www.placehold.it/200x150/EFEFEF/AAAAAA&amp;text=Image" alt=""/>
											</div>
											<div class="fileinput-preview fileinput-exists thumbnail" style="max-width: 200px; max-height: 150px;">
											</div>
											<div>
												<span class="btn default btn-file">
													<span class="fileinput-new">Select</span>
													<span class="fileinput-exists">Change</span>
													<input type="file" placeholder="thumbnail" class="form-control" file-model="f.thumb"/>
												</span>	
											</div>
										</div>
										<span class="help-block" ng-bind="errors['imageFiles.'+$index+'.thumb'][0]"></span>
									</td>
									<td ng:class="{'has-error':errors['imageFiles.'+$index+'.label'][0]}">
										<input type="text" class="form-control" ng-model="f.label">
										<span class="help-block" ng-bind="errors['imageFiles.'+$index+'.label'][0]"></span>
									</td>
									<td ng:class="{'has-error':errors['imageFiles.'+$index+'.order'][0]}">
										<input type="text" class="form-control" ng-model="f.order">
										<span class="help-block" ng-bind="errors['imageFiles.'+$index+'.order'][0]"></span>
									</td>
									<td>
										<label>
											<input type="radio" ng-model="f.coverimage" value="1" name="coverimage">
										</label>
									</td>									
									<td>
										<a href="#" class="btn default btn-sm" ng-click="imageRemove($index)">
										<i class="fa fa-times"></i> Remove </a>
									</td>
								</tr>
							</tbody>
						</table>
					</tab>
				</tabset>
				<!-- {{{error:errors} | json}} -->

				
				<!-- {{{product:product}|json}} -->
			</div>			
		</div>
		</form>
	</div>
</div>
<script type="text/ng-template" id="categoryLiTree">
	<li ng-repeat="c in childOf	(categories, parent)">
		<label><input type="checkbox" ng-model="c.selected" my-change="{{c._id}}">{{c.cat_title}}</label>
		<ul class="list-unstyled" ng-init="parent=c._id" ng-include="'categoryLiTree'"></ul>
	</li>	
</script>